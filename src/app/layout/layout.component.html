<div class="container-fluid pt-4">
  <div class="d-flex flex-column gap-4 w-100">
    <div class="d-flex align-items-center justify-content-left w-100">
      <h1 class="fs-1">{{ 'piezas de lego' | titlecase }}</h1>
    </div>
    <div class="d-flex align-items-center justify-content-left gap-2">
      <p-select
        placeholder="Seleccione una opciÃ³n"
        [options]="cols"
        optionLabel="header"
        style="text-transform: capitalize"
        [(ngModel)]="selectValue"
      />
      <div class="d-flex align-items-center gap-1">
        <p-auto-complete
          #inputElement
          [(ngModel)]="inputValue"
          [suggestions]="options"
          (completeMethod)="onInput()"
          (onSelect)="getLegos()"
          (onClear)="clearInput()"
          [showClear]="true"
        />
        @if (isLoading && inputValue !== '') {
        <p-progress-spinner
          ariaLabel="loading"
          strokeWidth="8"
          fill="transparent"
          [style]="{ width: '50px', height: '50px' }"
        />
        }
      </div>
    </div>
    @if (legos.length > 0 && inputValue !== '') {
    <div class="table-responsive">
      <p-table
        [value]="legos"
        [columns]="cols"
        showGridlines
        [tableStyle]="{ 'min-width': '50rem' }"
        [paginator]="true"
        [rows]="rows"
        [rowsPerPageOptions]="[5, 10, 20]"
        [loading]="isLoading"
      >
        <ng-template #header>
          <tr>
            <th>{{ 'imagen lego' | titlecase }}</th>
            <th>{{ 'imagen pieza' | titlecase }}</th>
            @for (col of cols; track col.field) {
            <th>{{ col.header | titlecase }}</th>
            }
            <th>{{ 'acciones' | titlecase }}</th>
          </tr>
        </ng-template>
        <ng-template #body let-rowData let-columns="columns">
          <tr>
            <td>
              <img [src]="rowData['imagen_lego']" alt="" style="width: 100px; height: 100px" />
            </td>
            <td>
              <img [src]="rowData['imagen_pieza']" alt="" style="width: 100px; height: 100px" />
            </td>
            @for (col of cols; track col.field) {
            <td>{{ rowData[col.field] }}</td>
            }
            <td>
              <div class="d-flex flex-column gap-2">
                <div>
                  <p-toast />
                  <p-button
                    label="Editar Lego"
                    severity="primary"
                    [style]="{ width: '100%', 'min-width': '150px' }"
                    (onClick)="onEdit(rowData)"
                  ></p-button>
                </div>
                <p-button
                  label="Eliminar Lego"
                  severity="danger"
                  [style]="{ width: '100%', 'min-width': '150px' }"
                  (onClick)="onDelete(rowData['id'])"
                ></p-button>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
    }
  </div>
</div>

<p-toast />
<p-confirm-dialog />
